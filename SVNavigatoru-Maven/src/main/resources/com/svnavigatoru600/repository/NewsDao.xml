<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- "namespace" specifies the interface for which this mapping file is determined -->
<mapper namespace="com.svnavigatoru600.repository.NewsDao">

	<cache />

	<!-- "resultMap" specifies the mapping between a domain class and an user table. -->
	<!-- In the "type" attribute, we are using an automatically generated (thanks to "typeAliasesPackage" 
		in mybatis.xml) alias of the domain class. -->
	<resultMap id="newsResultMap" type="News">
		<result property="id" column="id" />
		<result property="title" column="title" />
		<result property="text" column="text" />
		<result property="creationTime" column="creation_time" />
		<result property="lastSaveTime" column="last_save_time" />
	</resultMap>

	<sql id="newsTable">news</sql>
	<sql id="idColumn">id</sql>
	<sql id="titleColumn">title</sql>
	<sql id="textColumn">text</sql>
	<sql id="creationTimeColumn">creation_time</sql>
	<sql id="lastSaveTimeColumn">last_save_time</sql>

	<select id="findById" parameterType="int" resultMap="newsResultMap">
		SELECT *
		FROM <include refid="newsTable" />
		WHERE
		<include refid="idColumn" /> = #{id};
	</select>

	<select id="findOrdered" parameterType="com.svnavigatoru600.repository.news.impl.FindOrderedArguments"
		resultMap="newsResultMap">
		SELECT *
		FROM <include refid="newsTable" />
		ORDER BY creation_time ASC;
		<!-- this does not work: ORDER BY #{sortField.columnName} #{sortDirection.databaseCode}; -->
	</select>
	
	<insert id="save" parameterType="News" keyProperty="id">
	    INSERT INTO <include refid="newsTable" />
	    (<include refid="titleColumn" />, <include refid="textColumn" />, <include refid="creationTimeColumn" />, <include refid="lastSaveTimeColumn" />)
	    VALUES (#{title}, #{text}, #{creationTime}, #{lastSaveTime});
	</insert>

	<update id="update" parameterType="News">
		UPDATE <include refid="newsTable" />
		SET
		<include refid="titleColumn" /> = #{title},
		<include refid="textColumn" /> = #{text},
		<include refid="creationTimeColumn" /> = #{creationTime},
		<include refid="lastSaveTimeColumn" /> = #{lastSaveTime}
		WHERE
		<include refid="idColumn" /> = #{id};
	</update>

	<delete id="delete" parameterType="News">
		DELETE FROM <include refid="newsTable" />
		WHERE
		<include refid="idColumn" /> = #{id};
	</delete>
</mapper>
